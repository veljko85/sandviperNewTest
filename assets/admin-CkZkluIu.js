import{g as f,r as l,d as r,k as D,b as u,f as b,o as S,s as L}from"./firebase-B9yhNKLu.js";let o={discountCode:[],adminUid:null,users:[],emailsForCsv:[]};function N(){f(l(r,"admin_data/uid")).then(t=>{t.exists()&&(o.adminUid=t.val())}).catch(t=>{})}N();const v=async()=>{try{await D(u,email.value,password.value),I(),h=!0}catch{authErrorDisplay.style.visibility="visible"}};let h=!1;loginButton.onclick=()=>v();document.addEventListener("keydown",t=>{t.key==="Enter"&&h===!1&&v()});const E=async()=>{try{await b(u),M(),h=!1}catch{}};logoutButton.onclick=()=>E();adminLogOutButton.onclick=()=>{E(),adminLoginContainer.style.display="flex",adminContainer.style.display="none"};function I(){S(u,t=>{t&&(t.uid===o.adminUid?T():authErrorDisplay.style.visibility="visible")})}function T(){var t,n;adminLoginContainer.style.display="none",adminContainer.style.display="flex",adminEmail.innerHTML=(n=(t=u)==null?void 0:t.currentUser)==null?void 0:n.email,x(),H(),saveDiscountCodeButton.addEventListener("click",()=>{k()})}function x(){const t=l(r,"discount_code");f(t).then(n=>{o.discountCode=n.val();for(let e=0;e<o.discountCode.length;e++)e===0&&(document.getElementsByClassName("neededScoreInput")[0].value=o.discountCode[0].needed_score,document.getElementsByClassName("discountCodeInput")[0].value=o.discountCode[0].discount_code),e>0&&B(o.discountCode[e].needed_score,o.discountCode[e].discount_code)})}function k(){let t=!1,n=document.getElementsByClassName("discountCodeSeperatedContainer");o.discountCode=[];for(let e=0;e<n.length;e++)document.getElementsByClassName("neededScoreInput")[e].value!==""&&document.getElementsByClassName("discountCodeInput")[e].value!==""?o.discountCode.push({needed_score:document.getElementsByClassName("neededScoreInput")[e].value,discount_code:document.getElementsByClassName("discountCodeInput")[e].value}):(t=!0,document.getElementsByClassName("errorSuccessDisplay")[e].style.color="#ff0000",document.getElementsByClassName("errorSuccessDisplayIcon")[e].innerHTML="&#xf057;",document.getElementsByClassName("errorSuccessDisplayText")[e].innerHTML="Error",document.getElementsByClassName("errorSuccessDisplay")[e].style.visibility="visible",setTimeout(()=>{document.getElementsByClassName("errorSuccessDisplay")[e].style.visibility="hidden"},2e3));if(t===!1){const e=l(r,"discount_code");L(e,o.discountCode).then(i=>{for(let s=0;s<n.length;s++)document.getElementsByClassName("errorSuccessDisplay")[s].style.color="#00ff00",document.getElementsByClassName("errorSuccessDisplayIcon")[s].innerHTML="&#xf058;",document.getElementsByClassName("errorSuccessDisplayText")[s].innerHTML="Success",document.getElementsByClassName("errorSuccessDisplay")[s].style.visibility="visible",setTimeout(()=>{document.getElementsByClassName("errorSuccessDisplay")[s].style.visibility="hidden"},2e3)}).catch(i=>{for(let s=0;s<n.length;s++)document.getElementsByClassName("errorSuccessDisplay")[s].style.color="#ff0000",document.getElementsByClassName("errorSuccessDisplayIcon")[s].innerHTML="&#xf057;",document.getElementsByClassName("errorSuccessDisplayText")[s].innerHTML="Error",document.getElementsByClassName("errorSuccessDisplay")[s].style.visibility="visible",setTimeout(()=>{document.getElementsByClassName("errorSuccessDisplay")[s].style.visibility="hidden"},2e3)})}}function M(){email.value="",password.value="",authErrorDisplay.style.visibility="hidden"}let _=document.querySelectorAll(".discountCodeInput");_[0].style.marginRight="50px";function B(t,n){const e=document.createElement("div");e.className="discountCodeSeperatedContainer",e.innerHTML=`
        <h3 class="discountCodeHeaderTitle">Discount code</h3>
        <div class="errorSuccessDisplay">
            <h5 class="errorSuccessDisplayIcon fa">&#xf057;</h5>
            <h5 class="errorSuccessDisplayText">Error</h5>
        </div>
        <input class="neededScoreInput" type="number" placeholder="Needed score" value="${t}">
        <input class="discountCodeInput" type="text" placeholder="Discount code" value="${n}">
        <div class="discountCodeDeleteContainer fa">&#xf00d;</div>
    `,document.getElementById("discountCodeSeperatedContainers").appendChild(e),e.querySelector(".discountCodeDeleteContainer").addEventListener("click",()=>{e.remove()})}document.getElementById("addDiscountCodeButton").addEventListener("click",()=>B("",""));let a=1;const d=9;async function H(){const t=l(r,"users");f(t).then(n=>{o.users=n.val(),o.emailsForCsv=[];for(let e=1;e<o.users.length;e++)o.emailsForCsv.push({user_email:o.users[e].user_email});g(a),w()})}function g(t){let n=document.getElementById("usersList");n.innerHTML="";let e=(t-1)*d+1,i=Math.min(e+d-1,o.users.length-1);for(let s=e;s<=i;s++){let c=document.createElement("div");c.classList.add("user"),n.appendChild(c),s===o.users.length-1&&(c.style.marginBottom="50px"),s%2===0&&(c.style.backgroundColor="#f5f5f5");let m=document.createElement("h3");m.classList.add("userNumber"),m.innerHTML=s,c.appendChild(m);let y=document.createElement("h3");y.classList.add("userEmail"),y.innerHTML=o.users[s].user_email,c.appendChild(y);let C=document.createElement("h3");C.classList.add("userDiscountCode"),C.innerHTML=o.users[s].user_get_discount_code,c.appendChild(C)}}function w(){const t=Math.ceil((o.users.length-1)/d),n=document.createElement("div");n.id="pagination";const e=document.createElement("button");e.classList.add("paginationButton"),e.textContent="Previous",e.onclick=()=>{a>1&&(a--,g(a),p())};const i=document.createElement("button");i.classList.add("paginationButton"),i.textContent="Next",i.onclick=()=>{a<t&&(a++,g(a),p())};const s=document.createElement("span");s.id="pageInfo",n.appendChild(e),n.appendChild(s),n.appendChild(i),document.getElementById("usersContainer").appendChild(n),p()}function p(){const t=Math.ceil((o.users.length-1)/d);document.getElementById("pageInfo").textContent=`Page ${a} of ${t}`}function P(t){const n=Object.keys(t[0]).join(","),e=t.map(i=>Object.values(i).join(","));return[n,...e].join(`
`)}function U(){const t=P(o.emailsForCsv),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),e=URL.createObjectURL(n),i=document.createElement("a");i.href=e,i.setAttribute("download","data.csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}downloadCsvBtn.onclick=()=>U();
